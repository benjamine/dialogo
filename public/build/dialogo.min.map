{"version":3,"file":"bundle.js","sources":["/source-files/dialogo/node_modules/fiberglass/node_modules/browserify/node_modules/browser-pack/_prelude.js","/source-files/dialogo/src/main.js","/source-files/dialogo/src/doc.js","/source-files/dialogo/src/peer.js","/source-files/dialogo/src/storage.js","/source-files/dialogo/node_modules/fiberglass/node_modules/browserify/node_modules/process/browser.js","/source-files/dialogo/node_modules/fiberglass/node_modules/browserify/node_modules/events/events.js","/source-files/dialogo/node_modules/fiberglass/node_modules/browserify/node_modules/util/util.js","/source-files/dialogo/node_modules/fiberglass/node_modules/browserify/node_modules/util/support/isBufferBrowser.js","/source-files/dialogo/node_modules/jsondiffpatch/src/main.js","/source-files/dialogo/node_modules/jsondiffpatch/src/diffpatcher.js","/source-files/dialogo/node_modules/jsondiffpatch/src/date-reviver.js","/source-files/dialogo/node_modules/jsondiffpatch/src/environment.js","/source-files/dialogo/node_modules/jsondiffpatch/src/pipe.js","/source-files/dialogo/node_modules/jsondiffpatch/src/contexts/diff.js","/source-files/dialogo/node_modules/jsondiffpatch/src/processor.js","/source-files/dialogo/node_modules/jsondiffpatch/src/contexts/patch.js","/source-files/dialogo/node_modules/jsondiffpatch/src/contexts/reverse.js","/source-files/dialogo/node_modules/jsondiffpatch/src/filters/trivial.js","/source-files/dialogo/node_modules/jsondiffpatch/src/filters/nested.js","/source-files/dialogo/node_modules/jsondiffpatch/src/filters/arrays.js","/source-files/dialogo/node_modules/jsondiffpatch/src/filters/dates.js","/source-files/dialogo/node_modules/jsondiffpatch/src/filters/texts.js","/source-files/dialogo/node_modules/jsondiffpatch/src/contexts/context.js","/source-files/dialogo/node_modules/jsondiffpatch/src/filters/lcs.js","/source-files/dialogo/node_modules/fiberglass/node_modules/browserify/node_modules/inherits/inherits_browser.js"],"names":["Doc","root","version","this","jsondiffpatch","require","prototype","clone","doc","JSON","parse","stringify","dateReviver","url","empty","isEmpty","notFound","exports","Peer","name","document","events","EventEmitter","call","counters","messages","sent","received","createShadow","watchInterval","defaults","debug","util","inherits","log","args","Array","slice","apply","arguments","unshift","console","syncBroken","emit","stop","syncComplete","watch","use","req","documentRequest","callback","load","options","opt","self","local","loading","storage","get","err","Error","scan","save","saveRequest","saving","put","saved","shadow","send","message","lastSent","waitingResponse","receive","responding","responseTo","respond","response","error","isBusy","getChanges","delta","ping","watchTimer","setInterval","isPaused","source","Math","max","clearInterval","pause","resume","diff","peerError","sendNoop","noop","patch","alwaysRespondNoops","sendDoc","loadOptions","bindTo","peer","on","artificialDelay","setTimeout","boundTo","Storage","documents","create","process","module","nextTick","canSetImmediate","window","setImmediate","canPost","postMessage","addEventListener","f","queue","ev","data","stopPropagation","length","fn","shift","push","title","browser","env","argv","addListener","once","off","removeListener","removeAllListeners","binding","cwd","chdir","_events","_maxListeners","undefined","isFunction","arg","isNumber","isObject","isUndefined","defaultMaxListeners","setMaxListeners","n","isNaN","TypeError","type","er","handler","len","i","listeners","listener","m","newListener","warned","trace","g","fired","list","position","splice","key","ret","listenerCount","emitter","inspect","obj","opts","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","customInspect","stylizeWithColor","formatValue","str","styleType","style","styles","arrayToHash","array","hash","forEach","val","value","recurseTimes","constructor","isString","primitive","formatPrimitive","keys","Object","visibleKeys","getOwnPropertyNames","isError","indexOf","formatError","isRegExp","RegExp","toString","isDate","Date","base","braces","isArray","toUTCString","output","formatArray","map","formatProperty","pop","reduceToSingleString","simple","replace","isNull","l","hasOwnProperty","String","match","desc","getOwnPropertyDescriptor","set","split","line","join","substr","numLinesEst","reduce","prev","cur","ar","isNullOrUndefined","isSymbol","re","objectToString","d","e","isPrimitive","o","pad","timestamp","time","getHours","getMinutes","getSeconds","getDate","months","getMonth","prop","formatRegExp","format","objects","x","Number","_","deprecate","msg","deprecated","throwDeprecation","traceDeprecation","global","noDeprecation","debugEnviron","debugs","debuglog","NODE_DEBUG","toUpperCase","test","pid","bold","italic","underline","inverse","white","grey","black","blue","cyan","green","magenta","red","yellow","special","number","boolean","null","string","date","regexp","isBuffer","origin","add","copy","fill","readUInt8","environment","DiffPatcher","defaultInstance","unpatch","reverse","isBrowser","homepage","packageInfoModuleName","packageInfo","formatterModuleName","formatters","Processor","Pipe","DiffContext","PatchContext","ReverseContext","trivial","nested","arrays","dates","texts","processor","pipe","append","collectChildrenDiffFilter","diffFilter","objectsDiffFilter","shouldHaveResult","collectChildrenPatchFilter","patchFilter","collectChildrenReverseFilter","reverseFilter","left","right","parts","exec","UTC","filters","input","context","index","filter","filterName","exiting","next","resultCheck","prepend","names","after","params","before","clear","should","hasResult","noResult","Context","selfOptions","pipes","lastPipe","lastContext","nextPipe","nextAfterChildren","result","a","setResult","exit","leftType","rightType","leftIsArray","rightIsArray","children","child","childName","_t","arraysHaveMatchByRef","array1","array2","len1","len2","index1","val1","index2","val2","matchItems","value1","value2","objectHash","matchByPosition","hash1","hash2","hashCache1","hashCache2","lcs","ARRAY_MOVE","arrayIndexOf","item","matchContext","commonHead","commonTail","trimmed1","trimmed2","seq","removedItems","indices1","detectMove","includeValueOnMove","removedItemsLength","indexOnArray2","indices2","isMove","removeItemIndex1","compare","numerically","b","numericallyBy","toRemove","toInsert","toModify","parseInt","sort","indexDiff","removedValue","toInsertLength","insertion","toModifyLength","modification","newName","reverseArrayDeltaIndex","itemDelta","reverseIndex","deltaIndex","deltaItem","moveFromIndex","moveToIndex","deleteIndex","getTime","TEXT_DIFF","DEFAULT_MIN_LENGTH","cachedDiffPatch","getDiffMatchPatch","instance","diff_match_patch","dmpModuleName","dmp","diff_match_patch_not_found","txt1","txt2","patch_toText","patch_make","results","patch_apply","patch_fromText","textPatchFailed","minLength","textDiff","textDeltaReverse","lines","lineTmp","lineHeader","lineAdd","lineRemove","header","headerRegex","lineStart","switchTo","parent","defaultMatch","lengthMatrix","y","matrix","backtrack","sequence","subsequence","ctor","superCtor","super_","enumerable","writable","configurable","TempCtor"],"mappings":"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","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function(e){var r=require(\"./doc\").Doc,o=require(\"./peer\").Peer,t=require(\"./storage\").Storage;exports.Doc=r,exports.Peer=o,exports.Storage=t,exports.jsondiffpatch=require(\"jsondiffpatch\");var p=\"undefined\"!=typeof e&&\"string\"==typeof e.execPath;p||(exports.homepage=\"{{package-homepage}}\",exports.version=\"{{package-version}}\")}).call(this,require(\"_process\"));","var jsondiffpatch = require('jsondiffpatch');\n\nfunction Doc(root, version) {\n  this.root = typeof root === 'undefined' ? null : root;\n  this.version = version || 0;\n}\n\nDoc.prototype.clone = function () {\n  var doc = new Doc(\n    JSON.parse(JSON.stringify(this.root), jsondiffpatch.dateReviver),\n    this.version\n  );\n  doc.url = this.url;\n  return doc;\n};\n\nDoc.empty = new Doc(null, 0);\nDoc.empty.isEmpty = true;\n\nDoc.notFound = new Doc(null, 0);\nDoc.notFound.notFound = true;\n\nexports.Doc = Doc;\n","var events = require('events');\nvar jsondiffpatch = require('jsondiffpatch');\nvar util = require('util');\n\nvar Doc = require('./doc').Doc;\n\nfunction Peer(name, document){\n  events.EventEmitter.call(this);\n  if (name instanceof Doc) {\n    this.document = name;\n  } else {\n    this.name = name;\n    this.document = document || Doc.empty;\n  }\n  this.counters = {\n    messages: {\n      sent: 0,\n      received: 0\n    }\n  };\n  this.createShadow();\n  this.watchInterval = Peer.defaults.watchInterval;\n  this.debug = Peer.defaults.debug;\n}\nutil.inherits(Peer, events.EventEmitter);\n\nPeer.defaults = {\n  watchInterval: 100,\n  debug: false\n};\n\nPeer.prototype.log = function() {\n  if (this.debug) {\n    var args = Array.prototype.slice.apply(arguments);\n    args.unshift('[Peer ' + this.name + ']');\n    console.log.apply(console, args);\n  }\n};\n\nPeer.prototype.syncBroken = function () {\n  if (!this.synchronized) {\n    return;\n  }\n  this.synchronized = false;\n  this.emit('unsync');\n  this.stop();\n};\n\nPeer.prototype.syncComplete = function () {\n  if (this.synchronized) {\n    return;\n  }\n  this.synchronized = true;\n  this.log('sync complete');\n  this.emit('sync');\n  this.watch();\n};\n\nPeer.prototype.use = function(doc) {\n  this.log('document loaded locally:', doc.url);\n  this.document = doc;\n  this.createShadow();\n  this.emit('loaded');\n  var req = this.documentRequest;\n  if (req) {\n    this.documentRequest = null;\n    if (req.callback) {\n      req.callback();\n    }\n  }\n  this.syncComplete();\n};\n\nPeer.prototype.load = function(url, options, callback) {\n  var opt = options || {};\n  var self = this;\n  if (typeof options === 'function') {\n    callback = options;\n    opt = {};\n  }\n  this.documentRequest = {\n    url: url,\n    options: opt,\n    callback: callback\n  };\n  if (opt && opt.local) {\n    this.emit('load', url, callback);\n    if (!this.loading) {\n      if (this.storage) {\n        this.loading = true;\n        this.storage.get(url, opt, function(err, doc) {\n          self.loading = false;\n          if (err) {\n            callback(err);\n            return;\n          }\n          self.use(doc);\n        });\n        return;\n      }\n      this.log('no document loader for', url);\n      callback(new Error('no document loader'));\n    }\n  } else {\n    this.scan();\n  }\n};\n\nPeer.prototype.save = function(url, options, callback) {\n  var opt = options || {};\n  var self = this;\n  if (typeof options === 'function') {\n    callback = options;\n    opt = {};\n  }\n  this.saveRequest = {\n    url: url,\n    options: opt,\n    callback: callback\n  };\n  this.emit('save', url, callback);\n  if (!this.saving) {\n    if (this.storage) {\n      this.saving = true;\n      this.storage.put(url, this.document, options, function(err, url) {\n        self.saving = false;\n        if (err) {\n          callback(err);\n          return;\n        }\n        self.document.url = url;\n        self.saved();\n      });\n      return;\n    }\n    this.log('no document saver for', url);\n    callback(new Error('no document saver'));\n  }\n};\n\nPeer.prototype.saved = function() {\n  var doc = this.document;\n  this.log('document saved locally:', doc.url);\n  var req = this.saveRequest;\n  if (req) {\n    this.saveRequest = null;\n    if (req.callback) {\n      req.callback();\n    }\n  }\n};\n\nPeer.prototype.createShadow = function() {\n  this.shadow = this.document.clone();\n};\n\nPeer.prototype.send = function(message) {\n  this.counters.messages.sent++;\n  this.emit('message', message);\n  this.lastSent = message;\n  this.waitingResponse = true;\n};\n\nPeer.prototype.receive = function(message) {\n  var self = this;\n  this.waitingResponse = false;\n  this.responding = true;\n  this.counters.messages.received++;\n  message.responseTo = this.lastSent;\n  this.respond(message, function(err, response){\n    if (err) {\n      self.send({ error: err });\n      self.responding = false;\n      return;\n    }\n    if (response) {\n      self.send(response);\n    }\n    self.responding = false;\n  });\n};\n\nPeer.prototype.isBusy = function () {\n  return this.waitingResponse || this.responding;\n};\n\nPeer.prototype.scan = function(){\n  var self = this;\n  if (this.responding) {\n    return;\n  }\n\n  if (!this.waitingResponse && this.documentRequest) {\n    if (!this.documentRequest.options.local && !this.documentRequest.sent) {\n      this.log('requesting document', this.documentRequest.url);\n      this.send({\n        load: true,\n        url: this.documentRequest.url,\n        options: this.documentRequest.options\n      });\n      this.documentRequest.sent = true;\n    }\n    return;\n  }\n\n  if (!this.waitingResponse && this.saveRequest) {\n    if (!this.saveRequest.options.local && !this.saveRequest.sent) {\n      this.log('requesting to save document as', this.saveRequest.url);\n      this.send({\n        save: true,\n        url: this.saveRequest.url,\n        options: this.saveRequest.options\n      });\n      this.saveRequest.sent = true;\n    }\n    return;\n  }\n\n  this.getChanges(function(delta) {\n    if (!delta) {\n      return;\n    }\n    self.syncBroken();\n    if (self.isBusy()) {\n      self.log('ping');\n      self.send({ ping: true });\n      return;\n    }\n    self.document.version++;\n    self.createShadow();\n    self.send({\n      delta: delta,\n      version: self.document.version\n    });\n  });\n};\n\nPeer.prototype.watch = function () {\n  if (this.watchTimer) {\n    return;\n  }\n  var self = this;\n  this.watchTimer = setInterval(function(){\n    if (self.isPaused) {\n      return;\n    }\n    self.scan({ source: 'watch' });\n  }, Math.max(20, self.watchInterval));\n  this.log('watching...');\n};\n\nPeer.prototype.stop = function () {\n  if (!this.watchTimer) {\n    return;\n  }\n  clearInterval(this.watchTimer);\n  this.watchTimer = null;\n  this.log('watch stopped');\n};\n\nPeer.prototype.pause = function () {\n  if (this.isPaused) {\n    return;\n  }\n  this.isPaused = true;\n  this.emit('pause');\n};\n\nPeer.prototype.resume = function () {\n  if (!this.isPaused) {\n    return;\n  }\n  this.isPaused = false;\n  this.emit('resume');\n};\n\nPeer.prototype.getChanges = function (callback) {\n  // use jsondiffpatch to detect changes in document\n  var delta = jsondiffpatch.diff(this.shadow.root, this.document.root);\n  if (delta) {\n    this.log('found changes', delta);\n  }\n  callback(delta);\n};\n\nPeer.prototype.respond = function(message, callback) {\n  this.peerError = null;\n  var self = this;\n  var sendNoop = function(){\n    callback(null, { noop: true });\n  };\n\n  var req;\n\n  // respond to peer error\n  if (message.error) {\n    this.log('got peer error: ' + message.error);\n    this.peerError = message.error;\n    callback();\n    return;\n  }\n\n  // respond to a delta\n  if (message.delta) {\n    this.log('patching...');\n    try {\n      // exact patch\n      this.shadow.root = jsondiffpatch.patch(this.shadow.root, message.delta);\n    } catch (err) {\n      // out-of-sync TODO: reload the full doc\n      this.log('patch error: ', err);\n    }\n    try {\n      // best-effort patch\n      this.document.root = jsondiffpatch.patch(this.document.root, message.delta);\n    } catch (err) {\n      this.log('patch error (best-effort): ', err);\n    }\n    if (message.version && this.document.version <= message.version) {\n      this.document.version = message.version;\n    } else {\n      this.document.version++;\n    }\n    this.log('result:', this.document);\n    this.emit('change');\n  }\n\n  // respond to noop (peer has no changes)\n  if (message.noop) {\n    this.log('got noop');\n    // no changes on the other peer\n    if ((message.responseTo && message.responseTo.noop) && !this.alwaysRespondNoops) {\n      this.syncComplete();\n      callback();\n      return;\n    }\n  }\n\n  // respond to ping (peer wants to send a message, but is waiting for response)\n  if (message.ping) {\n    this.log('got ping');\n    if (this.waitingResponse) {\n      this.log('ignoring ping, waiting a response');\n      callback();\n      return;\n    }\n  }\n\n  // respond to this messages sending changes (if any)\n  if (message.noop || message.delta || message.ping || message.saved) {\n    this.getChanges(function(delta) {\n      if (!delta) {\n        if (message.noop) {\n          self.syncComplete();\n        }\n        sendNoop();\n        return;\n      }\n      self.document.version++;\n      self.createShadow();\n      callback(null, {\n        delta: delta,\n        version: self.document.version\n      });\n    });\n    return;\n  }\n\n  // respond to document load request\n  if (message.load) {\n    // peer wants to load a full document\n    this.log('got document load request');\n    var url = message.url;\n    var sendDoc = function(){\n      var doc = self.document.clone();\n      self.watch();\n      callback(null, {\n        document: {\n          root: doc.root,\n          url: doc.url,\n          version: doc.version\n        }\n      });\n    };\n    if (this.document.isEmpty || (url && this.document.url !== url)) {\n      this.log('loading', url);\n      var loadOptions = message.options || {};\n      loadOptions.local = true;\n      this.load(url, loadOptions, function(err) {\n        if (err) {\n          self.log('error loading document');\n          callback(null, {\n            error: err.message,\n            url: url\n          });\n          return;\n        }\n        self.log('document loaded, sending to peer', self.document);\n        sendDoc();\n        return;\n      });\n      return;\n    }\n    this.log('sending document', this.document);\n    sendDoc();\n    return;\n  }\n\n  // respond to full document\n  if (message.document) {\n    // peer sent the full document\n    req = this.documentRequest;\n    if (req && req.sent) {\n      this.documentRequest = null;\n    }\n    if (message.error) {\n      this.log('document load error');\n      callback();\n      return;\n    }\n    this.document = new Doc(message.document.root, message.document.version);\n    this.document.url = message.document.url;\n    this.createShadow();\n    this.log('got document', this.document);\n    this.emit('loaded');\n    this.syncComplete();\n    callback();\n    if (req && req.callback) {\n      req.callback();\n    }\n    return;\n  }\n\n  // respond to unexpected message\n  this.log('error', 'unexpected message', message);\n  callback(new Error('unexpected message'));\n};\n\nPeer.prototype.bindTo = function (peer, options) {\n  var self = this;\n  if (peer && typeof peer.on === 'function') {\n    var artificialDelay = Math.max(options && options.artificialDelay, 1);\n    peer.on('message', function(message) {\n      setTimeout(function(){\n        self.receive(message);\n      }, artificialDelay);\n    });\n    this.boundTo = peer;\n    if (peer instanceof Peer && !peer.boundTo) {\n      peer.bindTo(self, options);\n    }\n    return;\n  }\n  throw new Error('unsupported bind target');\n};\n\nexports.Peer = Peer;\n","\nvar Doc = require('./doc').Doc;\n\nfunction Storage(documents) {\n  // base implementation is in-memory\n  this.documents = documents || {};\n}\n\nStorage.prototype.get = function (url, options, callback) {\n  if (!this.documents || !this.documents[url]) {\n    if (!options || !options.create) {\n      var err = new Error('document not found');\n      err.notFound = true;\n      err.url = url;\n      callback(err);\n      return;\n    }\n    this.documents[url] = {};\n  }\n  var doc = this.documents[url];\n  if (!(doc instanceof Doc)) {\n    doc = this.documents[url] = new Doc(doc);\n  }\n  doc.url = url;\n  callback(null, doc);\n};\n\nStorage.prototype.put = function (url, doc, options, callback) {\n  if (!this.documents) {\n    this.documents = {};\n  }\n  if (!(doc instanceof Doc)) {\n    doc = new Doc(doc);\n  }\n  doc.url = url;\n  this.documents[url] = doc.clone();\n  callback(null, url);\n};\n\nexports.Storage = Storage;\n","// shim for using process in browser\n\nvar process = module.exports = {};\n\nprocess.nextTick = (function () {\n    var canSetImmediate = typeof window !== 'undefined'\n    && window.setImmediate;\n    var canPost = typeof window !== 'undefined'\n    && window.postMessage && window.addEventListener\n    ;\n\n    if (canSetImmediate) {\n        return function (f) { return window.setImmediate(f) };\n    }\n\n    if (canPost) {\n        var queue = [];\n        window.addEventListener('message', function (ev) {\n            var source = ev.source;\n            if ((source === window || source === null) && ev.data === 'process-tick') {\n                ev.stopPropagation();\n                if (queue.length > 0) {\n                    var fn = queue.shift();\n                    fn();\n                }\n            }\n        }, true);\n\n        return function nextTick(fn) {\n            queue.push(fn);\n            window.postMessage('process-tick', '*');\n        };\n    }\n\n    return function nextTick(fn) {\n        setTimeout(fn, 0);\n    };\n})();\n\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n}\n\n// TODO(shtylman)\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      }\n      throw TypeError('Uncaught, unspecified \"error\" event.');\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        len = arguments.length;\n        args = new Array(len - 1);\n        for (i = 1; i < len; i++)\n          args[i - 1] = arguments[i];\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    len = arguments.length;\n    args = new Array(len - 1);\n    for (i = 1; i < len; i++)\n      args[i - 1] = arguments[i];\n\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    var m;\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  var ret;\n  if (!emitter._events || !emitter._events[type])\n    ret = 0;\n  else if (isFunction(emitter._events[type]))\n    ret = 1;\n  else\n    ret = emitter._events[type].length;\n  return ret;\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","\nvar environment = require('./environment');\n\nvar DiffPatcher = require('./diffpatcher').DiffPatcher;\nexports.DiffPatcher = DiffPatcher;\n\nexports.create = function(options){\n\treturn new DiffPatcher(options);\n};\n\nexports.dateReviver = require('./date-reviver');\n\nvar defaultInstance;\n\nexports.diff = function() {\n\tif (!defaultInstance) {\n\t\tdefaultInstance = new DiffPatcher();\n\t}\n\treturn defaultInstance.diff.apply(defaultInstance, arguments);\n};\n\nexports.patch = function() {\n\tif (!defaultInstance) {\n\t\tdefaultInstance = new DiffPatcher();\n\t}\n\treturn defaultInstance.patch.apply(defaultInstance, arguments);\n};\n\nexports.unpatch = function() {\n\tif (!defaultInstance) {\n\t\tdefaultInstance = new DiffPatcher();\n\t}\n\treturn defaultInstance.unpatch.apply(defaultInstance, arguments);\n};\n\nexports.reverse = function() {\n\tif (!defaultInstance) {\n\t\tdefaultInstance = new DiffPatcher();\n\t}\n\treturn defaultInstance.reverse.apply(defaultInstance, arguments);\n};\n\nif (environment.isBrowser) {\n\texports.homepage = '{{package-homepage}}';\n\texports.version = '{{package-version}}';\n} else {\n\tvar packageInfoModuleName = '../package.json';\n\tvar packageInfo = require(packageInfoModuleName);\n\texports.homepage = packageInfo.homepage;\n\texports.version = packageInfo.version;\n\n\tvar formatterModuleName = './formatters';\n\tvar formatters = require(formatterModuleName);\n\texports.formatters = formatters;\n\t// shortcut for console\n\texports.console = formatters.console;\n}\n","var Processor = require('./processor').Processor;\nvar Pipe = require('./pipe').Pipe;\nvar DiffContext = require('./contexts/diff').DiffContext;\nvar PatchContext = require('./contexts/patch').PatchContext;\nvar ReverseContext = require('./contexts/reverse').ReverseContext;\n\nvar trivial = require('./filters/trivial');\nvar nested = require('./filters/nested');\nvar arrays = require('./filters/arrays');\nvar dates = require('./filters/dates');\nvar texts = require('./filters/texts');\n\nvar DiffPatcher = function DiffPatcher(options) {\n  this.processor = new Processor(options);\n  this.processor.pipe(new Pipe('diff').append(\n    nested.collectChildrenDiffFilter,\n    trivial.diffFilter,\n    dates.diffFilter,\n    texts.diffFilter,\n    nested.objectsDiffFilter,\n    arrays.diffFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('patch').append(\n    nested.collectChildrenPatchFilter,\n    arrays.collectChildrenPatchFilter,\n    trivial.patchFilter,\n    texts.patchFilter,\n    nested.patchFilter,\n    arrays.patchFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('reverse').append(\n    nested.collectChildrenReverseFilter,\n    arrays.collectChildrenReverseFilter,\n    trivial.reverseFilter,\n    texts.reverseFilter,\n    nested.reverseFilter,\n    arrays.reverseFilter\n  ).shouldHaveResult());\n};\n\nDiffPatcher.prototype.options = function() {\n  return this.processor.options.apply(this.processor, arguments);\n};\n\nDiffPatcher.prototype.diff = function(left, right) {\n  return this.processor.process(new DiffContext(left, right));\n};\n\nDiffPatcher.prototype.patch = function(left, delta) {\n  return this.processor.process(new PatchContext(left, delta));\n};\n\nDiffPatcher.prototype.reverse = function(delta) {\n  return this.processor.process(new ReverseContext(delta));\n};\n\nDiffPatcher.prototype.unpatch = function(right, delta) {\n  return this.patch(right, this.reverse(delta));\n};\n\nexports.DiffPatcher = DiffPatcher;\n","// use as 2nd parameter for JSON.parse to revive Date instances\nmodule.exports = function dateReviver(key, value) {\n  var parts;\n  if (typeof value === 'string') {\n    parts = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d*))?(Z|([+\\-])(\\d{2}):(\\d{2}))$/.exec(value);\n    if (parts) {\n      return new Date(Date.UTC(+parts[1], +parts[2] - 1, +parts[3], +parts[4], +parts[5], +parts[6], +(parts[7] || 0)));\n    }\n  }\n  return value;\n};\n","\nexports.isBrowser = typeof window !== 'undefined';\n","var Pipe = function Pipe(name) {\n  this.name = name;\n  this.filters = [];\n};\n\nPipe.prototype.process = function(input) {\n  if (!this.processor) {\n    throw new Error('add this pipe to a processor before using it');\n  }\n  var debug = this.debug;\n  var length = this.filters.length;\n  var context = input;\n  for (var index = 0; index < length; index++) {\n    var filter = this.filters[index];\n    if (debug) {\n      this.log('filter: ' + filter.filterName);\n    }\n    filter(context);\n    if (typeof context === 'object' && context.exiting) {\n      context.exiting = false;\n      break;\n    }\n  }\n  if (!context.next && this.resultCheck) {\n    this.resultCheck(context);\n  }\n};\n\nPipe.prototype.log = function(msg) {\n  console.log('[jsondiffpatch] ' + this.name + ' pipe, ' + msg);\n};\n\nPipe.prototype.append = function() {\n  this.filters.push.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.prepend = function() {\n  this.filters.unshift.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.indexOf = function(filterName) {\n  if (!filterName) {\n    throw new Error('a filter name is required');\n  }\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    if (filter.filterName === filterName) {\n      return index;\n    }\n  }\n  throw new Error('filter not found: ' + filterName);\n};\n\nPipe.prototype.list = function() {\n  var names = [];\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    names.push(filter.filterName);\n  }\n  return names;\n};\n\nPipe.prototype.after = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index + 1, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.before = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.clear = function() {\n  this.filters.length = 0;\n  return this;\n};\n\nPipe.prototype.shouldHaveResult = function(should) {\n  if (should === false) {\n    this.resultCheck = null;\n    return;\n  }\n  if (this.resultCheck) {\n    return;\n  }\n  var pipe = this;\n  this.resultCheck = function(context) {\n    if (!context.hasResult) {\n      console.log(context);\n      var error = new Error(pipe.name + ' failed');\n      error.noResult = true;\n      throw error;\n    }\n  };\n  return this;\n};\n\nexports.Pipe = Pipe;\n","var Context = require('./context').Context;\n\nvar DiffContext = function DiffContext(left, right) {\n  this.left = left;\n  this.right = right;\n  this.pipe = 'diff';\n};\n\nDiffContext.prototype = new Context();\n\nexports.DiffContext = DiffContext;\n","\nvar Processor = function Processor(options){\n\tthis.selfOptions = options;\n\tthis.pipes = {};\n};\n\nProcessor.prototype.options = function(options) {\n\tif (options) {\n\t\tthis.selfOptions = options;\n\t}\n\treturn this.selfOptions;\n};\n\nProcessor.prototype.pipe = function(name, pipe) {\n\tif (typeof name === 'string') {\n\t\tif (typeof pipe === 'undefined') {\n\t\t\treturn this.pipes[name];\n\t\t} else {\n\t\t\tthis.pipes[name] = pipe;\n\t\t}\n\t}\n\tif (name && name.name) {\n\t\tpipe = name;\n\t\tif (pipe.processor === this) { return pipe; }\n\t\tthis.pipes[pipe.name] = pipe;\n\t}\n\tpipe.processor = this;\n\treturn pipe;\n};\n\nProcessor.prototype.process = function(input, pipe) {\n\tvar context = input;\n\tcontext.options = this.options();\n\tvar nextPipe = pipe || input.pipe || 'default';\n\tvar lastPipe, lastContext;\n\twhile (nextPipe) {\n\t\tif (typeof context.nextAfterChildren !== 'undefined') {\n\t\t\t// children processed and coming back to parent\n\t\t\tcontext.next = context.nextAfterChildren;\n\t\t\tcontext.nextAfterChildren = null;\n\t\t}\n\n\t\tif (typeof nextPipe === 'string') {\n\t\t\tnextPipe = this.pipe(nextPipe);\n\t\t}\n\t\tnextPipe.process(context);\n\t\tlastContext = context;\n\t\tlastPipe = nextPipe;\n\t\tnextPipe = null;\n\t\tif (context) {\n\t\t\tif (context.next) {\n\t\t\t\tcontext = context.next;\n\t\t\t\tnextPipe = lastContext.nextPipe || context.pipe || lastPipe;\n\t\t\t}\n\t\t}\n\t}\n\treturn context.hasResult ? context.result : undefined;\n};\n\nexports.Processor = Processor;\n","var Context = require('./context').Context;\n\nvar PatchContext = function PatchContext(left, delta) {\n  this.left = left;\n  this.delta = delta;\n  this.pipe = 'patch';\n};\n\nPatchContext.prototype = new Context();\n\nexports.PatchContext = PatchContext;\n","var Context = require('./context').Context;\n\nvar ReverseContext = function ReverseContext(delta) {\n  this.delta = delta;\n  this.pipe = 'reverse';\n};\n\nReverseContext.prototype = new Context();\n\nexports.ReverseContext = ReverseContext;\n","var isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar diffFilter = function trivialMatchesDiffFilter(context) {\n  if (context.left === context.right) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  if (typeof context.left === 'undefined') {\n    if (typeof context.right === 'function') {\n      throw new Error('functions are not supported');\n    }\n    context.setResult([context.right]).exit();\n    return;\n  }\n  if (typeof context.right === 'undefined') {\n    context.setResult([context.left, 0, 0]).exit();\n    return;\n  }\n  if (typeof context.left === 'function' || typeof context.right === 'function') {\n    throw new Error('functions are not supported');\n  }\n  context.leftType = context.left === null ? 'null' : typeof context.left;\n  context.rightType = context.right === null ? 'null' : typeof context.right;\n  if (context.leftType !== context.rightType) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'boolean' || context.leftType === 'number') {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'object') {\n    context.leftIsArray = isArray(context.left);\n  }\n  if (context.rightType === 'object') {\n    context.rightIsArray = isArray(context.right);\n  }\n  if (context.leftIsArray !== context.rightIsArray) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n};\ndiffFilter.filterName = 'trivial';\n\nvar patchFilter = function trivialMatchesPatchFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult(context.delta[0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult(context.delta[1]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n};\npatchFilter.filterName = 'trivial';\n\nvar reverseFilter = function trivialReferseFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.delta).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult([context.delta[0], 0, 0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult([context.delta[1], context.delta[0]]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult([context.delta[0]]).exit();\n    return;\n  }\n};\nreverseFilter.filterName = 'trivial';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","var DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar collectChildrenDiffFilter = function collectChildrenDiffFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var result = context.result;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (typeof child.result === 'undefined') {\n      continue;\n    }\n    result = result || {};\n    result[child.childName] = child.result;\n  }\n  if (result && context.leftIsArray) {\n    result._t = 'a';\n  }\n  context.setResult(result).exit();\n};\ncollectChildrenDiffFilter.filterName = 'collectChildren';\n\nvar objectsDiffFilter = function objectsDiffFilter(context) {\n  if (context.leftIsArray || context.leftType !== 'object') {\n    return;\n  }\n\n  var name, child;\n  for (name in context.left) {\n    child = new DiffContext(context.left[name], context.right[name]);\n    context.push(child, name);\n  }\n  for (name in context.right) {\n    if (typeof context.left[name] === 'undefined') {\n      child = new DiffContext(undefined, context.right[name]);\n      context.push(child, name);\n    }\n  }\n\n  if (!context.children || context.children.length === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  context.exit();\n};\nobjectsDiffFilter.filterName = 'objects';\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new PatchContext(context.left[name], context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\npatchFilter.filterName = 'objects';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (context.left.hasOwnProperty(child.childName) && child.result === undefined) {\n      delete context.left[child.childName];\n    } else if (context.left[child.childName] !== child.result) {\n      context.left[child.childName] = child.result;\n    }\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'collectChildren';\n\nvar reverseFilter = function nestedReverseFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'objects';\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {};\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (delta[child.childName] !== child.result) {\n      delta[child.childName] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'collectChildren';\n\nexports.collectChildrenDiffFilter = collectChildrenDiffFilter;\nexports.objectsDiffFilter = objectsDiffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","var DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar lcs = require('./lcs');\n\nvar ARRAY_MOVE = 3;\n\nvar isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar arrayIndexOf = typeof Array.prototype.indexOf === 'function' ?\n  function(array, item) {\n    return array.indexOf(item);\n  } : function(array, item) {\n    var length = array.length;\n    for (var i = 0; i < length; i++) {\n      if (array[i] === item) {\n        return i;\n      }\n    }\n    return -1;\n  };\n\nfunction arraysHaveMatchByRef(array1, array2, len1, len2) {\n  for (var index1 = 0; index1 < len1; index1++) {\n    var val1 = array1[index1];\n    for (var index2 = 0; index2 < len2; index2++) {\n      var val2 = array2[index2];\n      if (val1 === val2) {\n        return true;\n      }\n    }\n  }\n}\n\nfunction matchItems(array1, array2, index1, index2, context) {\n  var value1 = array1[index1];\n  var value2 = array2[index2];\n  if (value1 === value2) {\n    return true;\n  }\n  if (typeof value1 !== 'object' || typeof value2 !== 'object') {\n    return false;\n  }\n  var objectHash = context.objectHash;\n  if (!objectHash) {\n    // no way to match objects was provided, try match by position\n    return context.matchByPosition && index1 === index2;\n  }\n  var hash1;\n  var hash2;\n  if (typeof index1 === 'number') {\n    context.hashCache1 = context.hashCache1 || [];\n    hash1 = context.hashCache1[index1];\n    if (typeof hash1 === 'undefined') {\n      context.hashCache1[index1] = hash1 = objectHash(value1, index1);\n    }\n  } else {\n    hash1 = objectHash(value1);\n  }\n  if (typeof hash1 === 'undefined') {\n    return false;\n  }\n  if (typeof index2 === 'number') {\n    context.hashCache2 = context.hashCache2 || [];\n    hash2 = context.hashCache2[index2];\n    if (typeof hash2 === 'undefined') {\n      context.hashCache2[index2] = hash2 = objectHash(value2, index2);\n    }\n  } else {\n    hash2 = objectHash(value2);\n  }\n  if (typeof hash2 === 'undefined') {\n    return false;\n  }\n  return hash1 === hash2;\n}\n\nvar diffFilter = function arraysDiffFilter(context) {\n  if (!context.leftIsArray) {\n    return;\n  }\n\n  var matchContext = {\n    objectHash: context.options && context.options.objectHash,\n    matchByPosition: context.options && context.options.matchByPosition\n  };\n  var commonHead = 0;\n  var commonTail = 0;\n  var index;\n  var index1;\n  var index2;\n  var array1 = context.left;\n  var array2 = context.right;\n  var len1 = array1.length;\n  var len2 = array2.length;\n\n  var child;\n\n  if (len1 > 0 && len2 > 0 && !matchContext.objectHash &&\n    typeof matchContext.matchByPosition !== 'boolean') {\n    matchContext.matchByPosition = !arraysHaveMatchByRef(array1, array2, len1, len2);\n  }\n\n  // separate common head\n  while (commonHead < len1 && commonHead < len2 &&\n    matchItems(array1, array2, commonHead, commonHead, matchContext)) {\n    index = commonHead;\n    child = new DiffContext(context.left[index], context.right[index]);\n    context.push(child, index);\n    commonHead++;\n  }\n  // separate common tail\n  while (commonTail + commonHead < len1 && commonTail + commonHead < len2 &&\n    matchItems(array1, array2, len1 - 1 - commonTail, len2 - 1 - commonTail, matchContext)) {\n    index1 = len1 - 1 - commonTail;\n    index2 = len2 - 1 - commonTail;\n    child = new DiffContext(context.left[index1], context.right[index2]);\n    context.push(child, index2);\n    commonTail++;\n  }\n  var result;\n  if (commonHead + commonTail === len1) {\n    if (len1 === len2) {\n      // arrays are identical\n      context.setResult(undefined).exit();\n      return;\n    }\n    // trivial case, a block (1 or more consecutive items) was added\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len2 - commonTail; index++) {\n      result[index] = [array2[index]];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  if (commonHead + commonTail === len2) {\n    // trivial case, a block (1 or more consecutive items) was removed\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len1 - commonTail; index++) {\n      result['_' + index] = [array1[index], 0, 0];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  // reset hash cache\n  delete matchContext.hashCache1;\n  delete matchContext.hashCache2;\n\n  // diff is not trivial, find the LCS (Longest Common Subsequence)\n  var trimmed1 = array1.slice(commonHead, len1 - commonTail);\n  var trimmed2 = array2.slice(commonHead, len2 - commonTail);\n  var seq = lcs.get(\n    trimmed1, trimmed2,\n    matchItems,\n    matchContext\n  );\n  var removedItems = [];\n  result = result || {\n    _t: 'a'\n  };\n  for (index = commonHead; index < len1 - commonTail; index++) {\n    if (arrayIndexOf(seq.indices1, index - commonHead) < 0) {\n      // removed\n      result['_' + index] = [array1[index], 0, 0];\n      removedItems.push(index);\n    }\n  }\n\n  var detectMove = true;\n  if (context.options && context.options.arrays && context.options.arrays.detectMove === false) {\n    detectMove = false;\n  }\n  var includeValueOnMove = false;\n  if (context.options && context.options.arrays && context.options.arrays.includeValueOnMove) {\n    includeValueOnMove = true;\n  }\n\n  var removedItemsLength = removedItems.length;\n  for (index = commonHead; index < len2 - commonTail; index++) {\n    var indexOnArray2 = arrayIndexOf(seq.indices2, index - commonHead);\n    if (indexOnArray2 < 0) {\n      // added, try to match with a removed item and register as position move\n      var isMove = false;\n      if (detectMove && removedItemsLength > 0) {\n        for (var removeItemIndex1 = 0; removeItemIndex1 < removedItemsLength; removeItemIndex1++) {\n          index1 = removedItems[removeItemIndex1];\n          if (matchItems(trimmed1, trimmed2, index1 - commonHead,\n            index - commonHead, matchContext)) {\n            // store position move as: [originalValue, newPosition, ARRAY_MOVE]\n            result['_' + index1].splice(1, 2, index, ARRAY_MOVE);\n            if (!includeValueOnMove) {\n              // don't include moved value on diff, to save bytes\n              result['_' + index1][0] = '';\n            }\n\n            index2 = index;\n            child = new DiffContext(context.left[index1], context.right[index2]);\n            context.push(child, index2);\n            removedItems.splice(removeItemIndex1, 1);\n            isMove = true;\n            break;\n          }\n        }\n      }\n      if (!isMove) {\n        // added\n        result[index] = [array2[index]];\n      }\n    } else {\n      // match, do inner diff\n      index1 = seq.indices1[indexOnArray2] + commonHead;\n      index2 = seq.indices2[indexOnArray2] + commonHead;\n      child = new DiffContext(context.left[index1], context.right[index2]);\n      context.push(child, index2);\n    }\n  }\n\n  context.setResult(result).exit();\n\n};\ndiffFilter.filterName = 'arrays';\n\nvar compare = {\n  numerically: function(a, b) {\n    return a - b;\n  },\n  numericallyBy: function(name) {\n    return function(a, b) {\n      return a[name] - b[name];\n    };\n  }\n};\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var index, index1;\n\n  var delta = context.delta;\n  var array = context.left;\n\n  // first, separate removals, insertions and modifications\n  var toRemove = [];\n  var toInsert = [];\n  var toModify = [];\n  for (index in delta) {\n    if (index !== '_t') {\n      if (index[0] === '_') {\n        // removed item from original array\n        if (delta[index][2] === 0 || delta[index][2] === ARRAY_MOVE) {\n          toRemove.push(parseInt(index.slice(1), 10));\n        } else {\n          throw new Error('only removal or move can be applied at original array indices' +\n            ', invalid diff type: ' + delta[index][2]);\n        }\n      } else {\n        if (delta[index].length === 1) {\n          // added item at new array\n          toInsert.push({\n            index: parseInt(index, 10),\n            value: delta[index][0]\n          });\n        } else {\n          // modified item at new array\n          toModify.push({\n            index: parseInt(index, 10),\n            delta: delta[index]\n          });\n        }\n      }\n    }\n  }\n\n  // remove items, in reverse order to avoid sawing our own floor\n  toRemove = toRemove.sort(compare.numerically);\n  for (index = toRemove.length - 1; index >= 0; index--) {\n    index1 = toRemove[index];\n    var indexDiff = delta['_' + index1];\n    var removedValue = array.splice(index1, 1)[0];\n    if (indexDiff[2] === ARRAY_MOVE) {\n      // reinsert later\n      toInsert.push({\n        index: indexDiff[1],\n        value: removedValue\n      });\n    }\n  }\n\n  // insert items, in reverse order to avoid moving our own floor\n  toInsert = toInsert.sort(compare.numericallyBy('index'));\n  var toInsertLength = toInsert.length;\n  for (index = 0; index < toInsertLength; index++) {\n    var insertion = toInsert[index];\n    array.splice(insertion.index, 0, insertion.value);\n  }\n\n  // apply modifications\n  var toModifyLength = toModify.length;\n  var child;\n  if (toModifyLength > 0) {\n    for (index = 0; index < toModifyLength; index++) {\n      var modification = toModify[index];\n      child = new PatchContext(context.left[modification.index], modification.delta);\n      context.push(child, modification.index);\n    }\n  }\n\n  if (!context.children) {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.exit();\n};\npatchFilter.filterName = 'arrays';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    context.left[child.childName] = child.result;\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'arraysCollectChildren';\n\nvar reverseFilter = function arraysReverseFilter(context) {\n  if (!context.nested) {\n    if (context.delta[2] === ARRAY_MOVE) {\n      context.newName = '_' + context.delta[1];\n      context.setResult([context.delta[0], parseInt(context.childName.substr(1), 10), ARRAY_MOVE]).exit();\n    }\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    if (name === '_t') {\n      continue;\n    }\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'arrays';\n\nvar reverseArrayDeltaIndex = function(delta, index, itemDelta) {\n  if (typeof index === 'string' && index[0] === '_') {\n    return parseInt(index.substr(1), 10);\n  } else if (isArray(itemDelta) && itemDelta[2] === 0) {\n    return '_' + index;\n  }\n\n  var reverseIndex = +index;\n  for (var deltaIndex in delta) {\n    var deltaItem = delta[deltaIndex];\n    if (isArray(deltaItem)) {\n      if (deltaItem[2] === ARRAY_MOVE) {\n        var moveFromIndex = parseInt(deltaIndex.substr(1), 10);\n        var moveToIndex = deltaItem[1];\n        if (moveToIndex === +index) {\n          return moveFromIndex;\n        }\n        if (moveFromIndex <= reverseIndex && moveToIndex > reverseIndex) {\n          reverseIndex++;\n        } else if (moveFromIndex >= reverseIndex && moveToIndex < reverseIndex) {\n          reverseIndex--;\n        }\n      } else if (deltaItem[2] === 0) {\n        var deleteIndex = parseInt(deltaIndex.substr(1), 10);\n        if (deleteIndex <= reverseIndex) {\n          reverseIndex++;\n        }\n      } else if (deltaItem.length === 1 && deltaIndex <= reverseIndex) {\n        reverseIndex--;\n      }\n    }\n  }\n\n  return reverseIndex;\n};\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {\n    _t: 'a'\n  };\n\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    var name = child.newName;\n    if (typeof name === 'undefined') {\n      name = reverseArrayDeltaIndex(context.delta, child.childName, child.result);\n    }\n    if (delta[name] !== child.result) {\n      delta[name] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'arraysCollectChildren';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","var diffFilter = function datesDiffFilter(context) {\n  if (context.left instanceof Date) {\n    if (context.right instanceof Date) {\n      if (context.left.getTime() !== context.right.getTime()) {\n        context.setResult([context.left, context.right]);\n      } else {\n        context.setResult(undefined);\n      }\n    } else {\n      context.setResult([context.left, context.right]);\n    }\n    context.exit();\n  } else if (context.right instanceof Date) {\n    context.setResult([context.left, context.right]).exit();\n  }\n};\ndiffFilter.filterName = 'dates';\n\nexports.diffFilter = diffFilter;\n","/* global diff_match_patch */\nvar TEXT_DIFF = 2;\nvar DEFAULT_MIN_LENGTH = 60;\nvar cachedDiffPatch = null;\n\nvar getDiffMatchPatch = function() {\n  /*jshint camelcase: false */\n\n  if (!cachedDiffPatch) {\n    var instance;\n    if (typeof diff_match_patch !== 'undefined') {\n      // already loaded, probably a browser\n      instance = typeof diff_match_patch === 'function' ?\n        new diff_match_patch() : new diff_match_patch.diff_match_patch();\n    } else if (typeof require === 'function') {\n      try {\n        var dmpModuleName = 'diff_match_patch_uncompressed';\n        var dmp = require('../../public/external/' + dmpModuleName);\n        instance = new dmp.diff_match_patch();\n      } catch (err) {\n        instance = null;\n      }\n    }\n    if (!instance) {\n      var error = new Error('text diff_match_patch library not found');\n      error.diff_match_patch_not_found = true;\n      throw error;\n    }\n    cachedDiffPatch = {\n      diff: function(txt1, txt2) {\n        return instance.patch_toText(instance.patch_make(txt1, txt2));\n      },\n      patch: function(txt1, patch) {\n        var results = instance.patch_apply(instance.patch_fromText(patch), txt1);\n        for (var i = 0; i < results[1].length; i++) {\n          if (!results[1][i]) {\n            var error = new Error('text patch failed');\n            error.textPatchFailed = true;\n          }\n        }\n        return results[0];\n      }\n    };\n  }\n  return cachedDiffPatch;\n};\n\nvar diffFilter = function textsDiffFilter(context) {\n  if (context.leftType !== 'string') {\n    return;\n  }\n  var minLength = (context.options && context.options.textDiff &&\n    context.options.textDiff.minLength) || DEFAULT_MIN_LENGTH;\n  if (context.left.length < minLength ||\n    context.right.length < minLength) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  // large text, use a text-diff algorithm\n  var diff = getDiffMatchPatch().diff;\n  context.setResult([diff(context.left, context.right), 0, TEXT_DIFF]).exit();\n};\ndiffFilter.filterName = 'texts';\n\nvar patchFilter = function textsPatchFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-patch algorithm\n  var patch = getDiffMatchPatch().patch;\n  context.setResult(patch(context.left, context.delta[0])).exit();\n};\npatchFilter.filterName = 'texts';\n\nvar textDeltaReverse = function(delta) {\n  var i, l, lines, line, lineTmp, header = null,\n    headerRegex = /^@@ +\\-(\\d+),(\\d+) +\\+(\\d+),(\\d+) +@@$/,\n    lineHeader, lineAdd, lineRemove;\n  lines = delta.split('\\n');\n  for (i = 0, l = lines.length; i < l; i++) {\n    line = lines[i];\n    var lineStart = line.slice(0, 1);\n    if (lineStart === '@') {\n      header = headerRegex.exec(line);\n      lineHeader = i;\n      lineAdd = null;\n      lineRemove = null;\n\n      // fix header\n      lines[lineHeader] = '@@ -' + header[3] + ',' + header[4] + ' +' + header[1] + ',' + header[2] + ' @@';\n    } else if (lineStart === '+') {\n      lineAdd = i;\n      lines[i] = '-' + lines[i].slice(1);\n      if (lines[i - 1].slice(0, 1) === '+') {\n        // swap lines to keep default order (-+)\n        lineTmp = lines[i];\n        lines[i] = lines[i - 1];\n        lines[i - 1] = lineTmp;\n      }\n    } else if (lineStart === '-') {\n      lineRemove = i;\n      lines[i] = '+' + lines[i].slice(1);\n    }\n  }\n  return lines.join('\\n');\n};\n\nvar reverseFilter = function textsReverseFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-diff algorithm\n  context.setResult([textDeltaReverse(context.delta[0]), 0, TEXT_DIFF]).exit();\n};\nreverseFilter.filterName = 'texts';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","\nvar Pipe = require('../pipe').Pipe;\n\nvar Context = function Context(){\n};\n\nContext.prototype.setResult = function(result) {\n\tthis.result = result;\n\tthis.hasResult = true;\n\treturn this;\n};\n\nContext.prototype.exit = function() {\n\tthis.exiting = true;\n\treturn this;\n};\n\nContext.prototype.switchTo = function(next, pipe) {\n\tif (typeof next === 'string' || next instanceof Pipe) {\n\t\tthis.nextPipe = next;\n\t} else {\n\t\tthis.next = next;\n\t\tif (pipe) {\n\t\t\tthis.nextPipe = pipe;\n\t\t}\n\t}\n\treturn this;\n};\n\nContext.prototype.push = function(child, name) {\n\tchild.parent = this;\n\tif (typeof name !== 'undefined') {\n\t\tchild.childName = name;\n\t}\n\tchild.root = this.root || this;\n\tchild.options = child.options || this.options;\n\tif (!this.children) {\n\t\tthis.children = [child];\n\t\tthis.nextAfterChildren = this.next || null;\n\t\tthis.next = child;\n\t} else {\n\t\tthis.children[this.children.length - 1].next = child;\n\t\tthis.children.push(child);\n\t}\n\tchild.next = this;\n\treturn this;\n};\n\nexports.Context = Context;\n","/*\n\nLCS implementation that supports arrays or strings\n\nreference: http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\n\n*/\n\nvar defaultMatch = function(array1, array2, index1, index2) {\n  return array1[index1] === array2[index2];\n};\n\nvar lengthMatrix = function(array1, array2, match, context) {\n  var len1 = array1.length;\n  var len2 = array2.length;\n  var x, y;\n\n  // initialize empty matrix of len1+1 x len2+1\n  var matrix = [len1 + 1];\n  for (x = 0; x < len1 + 1; x++) {\n    matrix[x] = [len2 + 1];\n    for (y = 0; y < len2 + 1; y++) {\n      matrix[x][y] = 0;\n    }\n  }\n  matrix.match = match;\n  // save sequence lengths for each coordinate\n  for (x = 1; x < len1 + 1; x++) {\n    for (y = 1; y < len2 + 1; y++) {\n      if (match(array1, array2, x - 1, y - 1, context)) {\n        matrix[x][y] = matrix[x - 1][y - 1] + 1;\n      } else {\n        matrix[x][y] = Math.max(matrix[x - 1][y], matrix[x][y - 1]);\n      }\n    }\n  }\n  return matrix;\n};\n\nvar backtrack = function(matrix, array1, array2, index1, index2, context) {\n  if (index1 === 0 || index2 === 0) {\n    return {\n      sequence: [],\n      indices1: [],\n      indices2: []\n    };\n  }\n\n  if (matrix.match(array1, array2, index1 - 1, index2 - 1, context)) {\n    var subsequence = backtrack(matrix, array1, array2, index1 - 1, index2 - 1, context);\n    subsequence.sequence.push(array1[index1 - 1]);\n    subsequence.indices1.push(index1 - 1);\n    subsequence.indices2.push(index2 - 1);\n    return subsequence;\n  }\n\n  if (matrix[index1][index2 - 1] > matrix[index1 - 1][index2]) {\n    return backtrack(matrix, array1, array2, index1, index2 - 1, context);\n  } else {\n    return backtrack(matrix, array1, array2, index1 - 1, index2, context);\n  }\n};\n\nvar get = function(array1, array2, match, context) {\n  context = context || {};\n  var matrix = lengthMatrix(array1, array2, match || defaultMatch, context);\n  var result = backtrack(matrix, array1, array2, array1.length, array2.length, context);\n  if (typeof array1 === 'string' && typeof array2 === 'string') {\n    result.sequence = result.sequence.join('');\n  }\n  return result;\n};\n\nexports.get = get;\n","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n"]}